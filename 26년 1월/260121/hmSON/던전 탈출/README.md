# [SWEA] 24615 [Pro] 던전 탈출 (D5) 문제 정리

## 1. 문제 개요
* **목표:** 정사각형 모양의 독가스로 가득 찬 던전에서 기사가 한 게이트에서 다른 게이트로 이동할 때 걸리는 최단 시간을 계산하는 프로그램을 구현한다. 게이트 생성(`addGate`), 게이트 철거(`removeGate`)에 의해 변화하는 게이트 현황을 관리하고, **지정된 두 게이트 사이의 최단 이동 시간**(`getMinTime`)를 반환해야 한다.
* **제약 사항:**
    * 시간 제한: 3초 / 메모리: 256MB (Heap + Static)
    * 맵의 크기 `N`: $12 \le N \le 350$
    * 기사의 최대 체력 `mMaxStamina`: $5 \le mMaxStamina \le 100$
    * 게이트 번호 `mGateID`: $1 \le mGateID \le 200$ 
    * 게이트 좌표 `mRow, mCol`: $0 \le mRow \le N-1, 0 \le mCol \le N-1$
    * 호출 횟수: `addGate`(200), `removeGate`(200), `getMinTime`(800)

## 2. 자료구조 및 알고리즘 설계
`getMinGate`에서 매번 1씩 이동하는 시뮬레이션을 돌리지 않고, 게이트 간의 관계를 미리 저장한 뒤 빠르게 게이트 간 인접 관계를 추적하여 지정 게이트 간 최단 거리를 구하는 것이 핵심입니다.

* **게이트 좌표 관리 (Array):** `mGateID`가 최대 200이므로 배열 인덱싱이 가능합니다. **int[2][201]** 크기의 배열에 각 게이트별 y축과 x축 정보를 저장하고, 게이트 철거, 게이트 존재 여부 확인시 $O(1)$로 접근합니다.
* **인접 게이트 탐색 (BFS with Queue):** 신규 게이트의 위치로부터 거리가 **mMaxStamina**인 곳까지만 기사가 이동할 수 있습니다. 따라서 그 이내에 존재하는 모든 공간을 탐색하여 발견한 모든 게이트를 인접 게이트로 등록합니다.
* **게이트 간 최단 시간 이동(Dijkstra with PriorityQueue):** 시작점으로부터 다른 게이트까지의 총 이동 거리를 관리하는 **Node** 클래스를 **이동 거리 오름차순**으로 정렬하여 가장 짧은 경로부터 우선적으로 탐색합니다.
* **지연 삭제(Lazy Deletion):** 게이트 철거시 모든 인접리스트를 순회하는 것은 비효율적입니다. 그러므로 **지연 삭제** 방식을 사용하여, 다익스트라 진행 중 이미 삭제된 게이트를 조회하려 하는 경우 즉시 폐기하는 방식을 취합니다.

## 3. 핵심 로직 흐름

### 3.1. `init` & `addGate` (초기화 및 신규 게이트 생성)
* **초기화:** 게이트 간 인접 리스트(`graph`), 게이트 조회용 배열(`gates`), 맵 정보(`map`)를 초기화합니다.
* **신규 게이트 생성:**
    * gates[][]의 mGateID번 인덱스에 좌표 등록
    * map[mRow][mCol]에 게이트 번호 등록
    * graph의 mGateID번 인덱스에 인접 리스트 생성하고 BFS를 이용해 인접 게이트 탐색

### 3.2. `BFS` (인접 게이트 탐색)
* **초기 위치 등록:** 신규 생성된 게이트의 좌표를 BFS 시작점으로 등록
* **탐색 시작:** Queue에서 현재 위치의 좌표를 꺼냄
    * **limit:** 기사의 최대 체력을 전부 소모하면 그 이상 움직일 수 없음
    * **4방향 탐색:** 아직 방문하지 않은 미방문 공간일 경우 1칸 이동
    * **게이트 여부 확인:** 다음 이동할 위치가 게이트인 경우 시작점인 게이트와 현재 위치에 존재하는 게이트 간 인접 관계를 `graph`에 등록

### 3.3. `removeGate` (게이트 철거)
* **조회:** gates[][]에서 해당 게이트의 (y, x) 좌표 반환
* **삭제:** gates[][]에서 해당 게이트의 좌표를 다시 (-1, -1)로 초기화. 추가로 map[y][x]에 등록된 게이트 번호도 다시 일반 공간인 0으로 변경

### 3.4. `getMinTime` (두 게이트 간 이동시 최단 시간 반환)
* **탐색 (Loop):** 우선순위 큐에서 노드를 하나씩 반환
* **게이트 검증:** 현재 위치가 목표 게이트인 경우 즉시 현재까지의 총 이동 시간을 반환하고 종료
* **지연 삭제 (Lazy Deletion):** 다음 게이트의 좌표가 (-1, -1)인 경우 이미 없는 게이트이므로 인접 리스트에서 해당 게이트 정보를 폐기
* **다음 경로 탐색:** 다음 게이트까지의 이동 시 소요 시간을 현재까지의 총 소요 시간에 더한 뒤 다음 게이트 번호, 총 소요 시간 정보를 가진 `Node` 객체를 우선순위 큐에 등록