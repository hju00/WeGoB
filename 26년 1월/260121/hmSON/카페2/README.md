# [SWEA] 24996 [Pro] 카페2 (D6) 문제 정리

## 1. 문제 개요
* **목표:** 다양한 음료 주문을 관리하는 시스템을 구현한다. 주문 접수(`order`), 음료 제조 및 배분(`supply`), 주문 취소(`cancel`), 주문 상태 확인(`getStatus`)을 처리하고, 기준에 따라 **가장 급하게 처리해야 할 주문 5개**(`hurry`)를 반환해야 한다.
* **우선순위 기준 (Hurry):**
    1.  남은 음료의 개수가 **많은** 주문 우선
    2.  가장 **먼저** 들어온(주문 번호가 작은) 주문 우선
* **제약 사항:**
    * 시간 제한: 3초 / 메모리: 256MB (Heap + Static)
    * 음료 종류 $N$: $3 \le N \le 10$
    * 주문 번호 `mID`: $1 \le mID \le 10^9$ (범위가 매우 큼)
    * 호출 횟수: `order`(20,000), `supply`(50,000), `cancel`(1,000), `hurry`(10,000)

## 2. 자료구조 및 알고리즘 설계
주문 번호의 범위가 넓고 `supply`와 `hurry`의 호출 빈도가 높기 때문에, 탐색 시간을 최소화하는 것이 핵심입니다.

* **주문 관리 (HashMap):** `mID`가 최대 10억이므로 배열 인덱싱이 불가능합니다. **HashMap**을 사용하여 주문 객체(`Order`)에 $O(1)$로 접근합니다.
* **음료 배분 (Bucket Queue):** 음료 종류($N$)가 최대 10개로 매우 적습니다. 각 음료 종류별로 **대기 중인 주문 ID를 담는 큐(Bucket)**를 배열로 관리합니다. 이를 통해 `supply` 호출 시 전체 주문을 탐색할 필요 없이 해당 음료를 기다리는 주문을 즉시($O(1)$) 찾아낼 수 있습니다.
* **우선순위 관리 (Lazy Propagation):** `hurry` 기능을 위해 **우선순위 큐(Heap)**를 사용합니다. 단, 음료가 배분될 때마다 큐 내부의 우선순위를 갱신하는 것은 비효율적입니다. 따라서 **지연 갱신(Lazy Propagation)** 방식을 사용하여, 큐에서 꺼낸 시점의 데이터가 최신 상태와 다를 경우에만 갱신하거나 폐기하는 방식을 취합니다.

## 3. 핵심 로직 흐름

### 3.1. `init` & `order` (초기화 및 주문)
* **초기화:** 음료 종류별 대기 큐(`beverageQueue`)의 포인터(`front`, `back`)와 HashMap, PQ를 초기화합니다.
* **주문 접수:**
    * `Order` 객체를 생성하여 HashMap에 저장합니다. (필드: 전체 개수, 현재 배분 개수, 주문 순서 시퀀스 등)
    * 주문에 포함된 각 음료 번호에 해당하는 **Bucket Queue**에 주문 ID를 삽입합니다.
    * `hurry` 처리를 위해 초기 상태(남은 개수 = 전체 개수)를 PQ에 삽입합니다.

### 3.2. `supply` (음료 배분)
* **매칭:** 제조된 음료 번호(`mBeverage`)에 해당하는 Bucket Queue를 확인합니다.
* **유효성 검증 (Loop):** Queue에서 주문 ID를 꺼냅니다.
    * **Skip:** HashMap에 없는 주문(취소됨)이거나, `finished` 플래그가 `true`인 주문(완료됨)이면 무시하고 다음 ID를 꺼냅니다.
    * **배분:** 유효한 주문을 찾으면 해당 주문의 `cnt`(배분된 수)를 증가시킵니다.
* **완료 처리:** 만약 `cnt == total`이 되면 `finished = true`로 설정하고 활성 주문 수를 감소시킵니다.

### 3.3. `cancel` (주문 취소)
* **검증:** 이미 완료되었거나 존재하지 않는 주문이면 즉시 종료합니다.
* **삭제:** HashMap에서 해당 주문을 `remove` 합니다.
* **재배분 (Redistribution):** 취소된 주문에 이미 배분되었던 음료들이 있다면 버리지 않고 재활용해야 합니다. 취소된 주문이 가지고 있던 음료 리스트를 순회하며 내부적으로 `supply()` 함수를 호출해 다른 대기 주문으로 넘겨줍니다.

### 3.4. `hurry` (우선순위 조회)
* **탐색 (Loop):** 우선순위 큐에서 노드를 하나씩 꺼냅니다. (최대 5개를 찾을 때까지)
* **지연 갱신 (Lazy Update):**
    * **Invalid:** HashMap에 없거나 `finished` 상태면 버립니다.
    * **Update:** 노드에 저장된 '남은 개수'보다 실제 객체의 '남은 개수'가 더 작다면(정보 갱신 필요), 최신 값으로 업데이트하여 큐에 다시 넣고 `continue` 합니다.
* **선정 및 복구:** 유효한 주문을 찾으면 결과 리스트에 담고 임시 큐에 보관합니다. 함수 종료 직전 임시 큐의 내용들을 다시 PQ에 복구시킵니다. (조회 작업이므로 데이터가 사라지면 안 됨)