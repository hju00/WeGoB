# [SWEA] 25870 [Pro] 파일공유 문제 정리


## 1. 문제 개요

* **목표:** 특정 컴퓨터가 특정 파일을 다운로드 요청했을 때 접근 가능한 다른 컴퓨터로부터 공유 파일을 받으면서(downloadFile), 컴퓨터 간 링크(addLink)/ 새 공유 파일(addShareFile)이 추가되는 동적 상황을 관리하고, 특정 시각 기준 현재까지 다운로드된 파일 크기를 반환(getFileSize)하는 프로그램을 구현한다.

* **조건:**
    * 한 컴퓨터는 거리가 5,000 이하인 다른 컴퓨터의 "**공유 파일**"을 다운로드할 수 있다.
    * 여러 개의 컴퓨터가 동일한 "**공유 파일**"을 가진 경우 동시에 다운로드할 수 있다.
    * 파일 다운로드 속도는 **1초에 공유 파일 하나당 9 크기만큼** 다운로드한다.
    * 예: 접근 가능한 공유 파일이 5개인 경우 **초당 9*5=45 크기만큼** 다운로드한다.
    * 단, **파일 다운로드가 완료되어도 그 파일을 공유하지 않는다.**
    * 새 링크 추가/ 새 공유 파일 추가 직후 다운로드 요청 상태인 컴퓨터는 **이 변화로 인해 새 공유 파일에 접근할 수 있게 된 경우 즉시 해당 공유 파일도 다운로드**한다.
* **제약 사항:**
    * 시간 제한: 3초 / 메모리: 256MB(Heap + Static)
    * 컴퓨터 수 `N`: $5 \le N \le 1,000$
        * 각 컴퓨터의 번호는 1~N까지이다.
    * 초기 링크 수 `K`: $1 \le K \le 2,000$
    * 각 컴퓨터별 보유 가능한 공유 파일 수 `mShareFileCnt[i]`: $0 \le mShareFileCnt[i] \le 50$
    * 각 파일 번호 `mFileID[i][k]`: $100 \le mFileID[i][k] \le 1,000,000$
    * 각 파일 크기 `mFileSize[i][k]`: $1,000 \le mFileSize[i][k] \le 1,000,000$
        * 파일 아이디가 같으면 동일한 파일임(파일 크기 동일)이 보장된다.
        * 한 컴퓨터에 동일한 파일이 존재할 수 없다.
        * 사용하는 파일의 종류는 최대 500개이다.
    * 현재 시각 `mTime`: $1 \le mTime \le 1,000,000$
        * 초기화 함수 호출 시점의 시각은 0이다.
    * 링크 거리 `mDis`: $500 \le mDis \le 3,000$
---

## 2. 자료구조 및 알고리즘 설계

* **coms\(Computer[]\), files\(HashMap\):** 컴퓨터 번호는 최대 1000이고 번호는 1~N까지이므로 배열로 관리 가능, 파일 번호는 최대 1,000,000이고 최대 사용량도 500개뿐이므로 메모리 효율을 위해 HashMap으로 관리
* 다운로드 진행량에 대해 지연 갱신이 요구된다. 조회 쿼리(`getFileSize`) 또는 갱신 쿼리(`addLink`, `addShareFile`)가 발생할 경우 영향을 받는 다운로드 파일들만 다운로드 현황을 갱신해야 한다.
* **q\(PriorityQueue\), dist\(int[]\):** 접근 가능한 컴퓨터 목록을 탐색해야 하는 추가 쿼리(`downloadFile`)와 갱신 쿼리(`addLink1, addShareFile`)가 호출될 때마다 다익스트라 탐색으로 제한 거리 이내의 컴퓨터들을 탐색해야 한다. 
* **comsFromA, comsFromB\(HashMap\):** (`addLink`)의 경우 링크 추가이므로 두 컴퓨터가 관여하며 **새 링크를 반드시 통과하는 거리 5000 이내의 모든 경로**를 확인하고 공유 파일 다운로드 가능 여부를 확인해야 한다.
* **Computer\(Class\):** 각 컴퓨터는 공유 파일과 다운로드 파일을 반드시 구분해서 관리해야 한다. 
* **DownloadFile\(Class\):** 다운로드 파일의 경우 **접근 가능한 공유 파일을 보유한 컴퓨터 목록, 접근 가능한 공유 파일 수, 최종 갱신 시각, 현재 다운로드 용량**을 모두 관리하고 있어야 지연 갱신을 적용할 수 있을 것이다.
---

## 3. 핵심 로직 흐름

### 3.1. `init` (초기화)

* **초기화:** 파일 용량 정보(`files`), 컴퓨터 객체 정보(`coms`), 링크 인접 리스트(`graph`), 컴퓨터별 공유 파일 정보(`coms[i].shareFiles`) 초기화

### 3.2. `makeNet` (그래프 초기화)

* **그래프 초기화:** 컴퓨터 간 링크 정보(`graph`, `Node`) 초기화, 각 링크는 최소 500, 최대 3000의 거리를 가짐.

### 3.3 `update` (파일 다운로드 현황 갱신)

* **다운로드 진행 여부 확인:** 이미 다운로드가 완료된 경우 갱신 의무 없음
* **다운로드 용량 현황 갱신:** (경과 시간 = 현재 시각 - 최종 갱신 시각)임을 이용하여 경과 시간 동안의 다운로드 용량을 추가하고 최종 갱신 시각을 현재 시각으로 변경
* **다운로드 완료 여부 확인:** 다운로드 용량 현황 갱신 후의 용량이 `files(HashMap)`에 명시된 파일별 용량값 이상인 경우 최대값으로 보정하고 다운로드 완료 처리

### 3.4. `addLink` (신규 링크 추가)

* **링크 추가:** 새 링크를 `graph` 인접 리스트에 양방향 연결
* **새 링크를 반드시 지나는 경로 조회:** 새 링크를 반드시 포함하는 모든 경로 조회
    * **두 컴퓨터를 시작점으로 하는 다익스트라 탐색:** 새 링크를 이루는 두 컴퓨터로부터 거리가 (5000 - mDis) 이하인 컴퓨터 번호와 거리를 각각 저장
    * **새 링크를 경유하는 모든 경로 확인:** (distA + mDis + distB <= 5000)인 모든 경로를 탐색하며 두 컴퓨터 간에 다운로드 가능한 공유 파일이 존재하는 지 확인
    * **지연 갱신:** 새 공유 파일을 받는 경우가 존재하면 즉시 해당 다운로드 파일의 현황 갱신(`update`)

### 3.5. `addShareFile` (신규 공유 파일 추가)

* **공유 파일 추가:** 지정 컴퓨터에 새 공유 파일 추가
* **공유 파일 다운로드:** mFileID 파일을 다운로드 요청한 주변 컴퓨터에서 해당 공유 파일 다운로드
    * **접근 가능한 컴퓨터 탐색:** 현재 위치로부터 거리가 5000 이하인 컴퓨터를 탐색하여 mFileID 파일 다운로드를 요청한 상태인지 확인
    * **지연 갱신:** 새 공유 파일을 받는 경우가 존재하면 즉시 해당 다운로드 파일의 현황 갱신(`update`)

### 3.6. `downloadFile` (파일 다운로드 요청)

* **공유 파일 다운로드:** 접근 가능한 주변 컴퓨터로부터 mFileID 공유 파일을 다운로드 받음
    * **접근 가능한 컴퓨터 탐색:** 현재 위치로부터 거리가 5000 이하인 컴퓨터를 탐색하여 mFileID **공유 파일**을 가지고 있는지 확인
    * **공유 파일을 보유한 모든 컴퓨터 번호 저장:** 차후 중복 다운로드를 방지하기 위해 공유 파일을 다운로드하기 위해 접근한 컴퓨터의 번호를 모두 기록
* **파일 등록:** 해당 컴퓨터에 mFileID 파일을 다운로드 목록에 등록
    * **공유 파일이 하나도 없으면?:** 다운로드 요청 상태는 유지한다. 다만 새 공유 파일을 발견하기 전까진 영원히 다운로드 용량이 0일 뿐.
* **탐색된 공유 파일 개수 반환:** 상기한 다익스트라 탐색 과정에서 다운로드 받기 시작한 모든 공유 파일 수 반환. 없으면 0 반환.

### 3.7 `getFileSize` (파일 크기 조회)

* **파일 종류 확인:** 찾는 파일은 해당 컴퓨터에서 공유 파일인가? 아니면 다운로드 파일인가? 또는 없는 파일인가?
* **공유 파일인 경우:** 공유 파일인 경우 모든 용량을 온전히 가진 상태이므로 mFileID 파일의 용량 크기를 그대로 반환
* **다운로드 파일로 가정:** 공유 파일 목록에 없었으므로 다운로드 목록을 탐색
    * **다운로드 파일 목록에도 없음:** 0 반환
    * **이미 다운로드가 끝난 파일:** 추가 갱신 없이 즉시 파일 크기 반환
    * **지연 갱신:** 새 공유 파일을 받는 경우가 존재하면 즉시 해당 다운로드 파일의 현황 갱신(`update`)
    * **파일 크기 반환:** 파일 다운로드 현황 최신화 이후 파일 크기 반환
